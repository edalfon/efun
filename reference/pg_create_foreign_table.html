<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Create a foreign table in Postgres, to directly access data in a text file — pg_create_foreign_table • efun</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Create a foreign table in Postgres, to directly access data in a text file — pg_create_foreign_table"><meta property="og:description" content="The use case for this function is as follows:
You get a large file (csv, tab-delimited) and would rather wrangle such
data in postgres. Instead of go ahead and copy all the data into a table,
let's create a foreign table that you can query just like a regular table."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">efun</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../articles/efun.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/abridge.html">Abridge tabular data</a>
    </li>
  </ul></li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/edalfon/efun/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Create a foreign table in Postgres, to directly access data in a text file</h1>
    <small class="dont-index">Source: <a href="https://github.com/edalfon/efun/blob/HEAD/R/postgres.R" class="external-link"><code>R/postgres.R</code></a></small>
    <div class="hidden name"><code>pg_create_foreign_table.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>The use case for this function is as follows:
You get a large file (csv, tab-delimited) and would rather wrangle such
data in postgres. Instead of go ahead and copy all the data into a table,
let's create a foreign table that you can query just like a regular table.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="fu">pg_create_foreign_table</span><span class="op">(</span>
  <span class="va">con</span>,
  <span class="va">file_path</span>,
  <span class="va">table</span>,
  sep <span class="op">=</span> <span class="st">";"</span>,
  nrows <span class="op">=</span> <span class="fl">10000</span>,
  header <span class="op">=</span> <span class="cn">TRUE</span>,
  na.strings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">""</span>, <span class="st">"NA"</span>, <span class="st">"NULL"</span><span class="op">)</span>,
  colClasses <span class="op">=</span> <span class="cn">NULL</span>,
  encoding <span class="op">=</span> <span class="st">"UTF-8"</span>,
  <span class="va">...</span>,
  drop_table <span class="op">=</span> <span class="cn">FALSE</span>,
  cascade <span class="op">=</span> <span class="cn">FALSE</span>,
  if_not_exists <span class="op">=</span> <span class="cn">FALSE</span>,
  create_foreign_server <span class="op">=</span> <span class="cn">TRUE</span>,
  execute <span class="op">=</span> <span class="cn">FALSE</span>,
  quote <span class="op">=</span> <span class="st">"\b"</span>,
  escape <span class="op">=</span> <span class="va">quote</span>,
  null <span class="op">=</span> <span class="st">"NULL"</span>
<span class="op">)</span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>con</dt>
<dd><p>A database connection.</p></dd>
<dt>file_path</dt>
<dd><p>path to a text file (csv, tab-delimited, etc.)</p></dd>
<dt>table</dt>
<dd><p>Name of the table. Escaped with
<code><a href="https://dbi.r-dbi.org/reference/dbQuoteIdentifier.html" class="external-link">dbQuoteIdentifier()</a></code>.</p></dd>
<dt>sep</dt>
<dd><p>The separator between columns. Defaults to the character in the set <code>[,\t |;:]</code> that separates the sample of rows into the most number of lines with the same number of fields. Use <code>NULL</code> or <code>""</code> to specify no separator; i.e. each line a single character column like <code><a href="https://rdrr.io/r/base/readLines.html" class="external-link">base::readLines</a></code> does.</p></dd>
<dt>nrows</dt>
<dd><p>The maximum number of rows to read. Unlike <code>read.table</code>, you do not need to set this to an estimate of the number of rows in the file for better speed because that is already automatically determined by <code>fread</code> almost instantly using the large sample of lines. <code>nrows=0</code> returns the column names and typed empty columns determined by the large sample; useful for a dry run of a large file or to quickly check format consistency of a set of files before starting to read any of them.</p></dd>
<dt>header</dt>
<dd><p>Does the first data line contain column names? Defaults according to whether every non-empty field on the first data line is type character. If so, or TRUE is supplied, any empty column names are given a default name.</p></dd>
<dt>na.strings</dt>
<dd><p>A character vector of strings which are to be interpreted as <code>NA</code> values. By default, <code>",,"</code> for columns of all types, including type <code>character</code> is read as <code>NA</code> for consistency. <code>,"",</code> is unambiguous and read as an empty string. To read <code>,NA,</code> as <code>NA</code>, set <code>na.strings="NA"</code>. To read <code>,,</code> as blank string <code>""</code>, set <code>na.strings=NULL</code>. When they occur in the file, the strings in <code>na.strings</code> should not appear quoted since that is how the string literal <code>,"NA",</code> is distinguished from <code>,NA,</code>, for example, when <code>na.strings="NA"</code>.</p></dd>
<dt>colClasses</dt>
<dd><p>As in <code><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">utils::read.csv</a></code>; i.e., an unnamed vector of types corresponding to the columns in the file, or a named vector specifying types for a subset of the columns by name. The default, <code>NULL</code> means types are inferred from the data in the file. Further, <code>data.table</code> supports a named <code>list</code> of vectors of column names <em>or numbers</em> where the <code>list</code> names are the class names; see examples. The <code>list</code> form makes it easier to set a batch of columns to be a particular class. When column numbers are used in the <code>list</code> form, they refer to the column number in the file not the column number after <code>select</code> or <code>drop</code> has been applied.
    If type coercion results in an error, introduces <code>NA</code>s, or would result in loss of accuracy, the coercion attempt is aborted for that column with warning and the column's type is left unchanged. If you really desire data loss (e.g. reading <code>3.14</code> as <code>integer</code>) you have to truncate such columns afterwards yourself explicitly so that this is clear to future readers of your code.</p></dd>
<dt>encoding</dt>
<dd><p>default is <code>"unknown"</code>. Other possible options are <code>"UTF-8"</code> and <code>"Latin-1"</code>.  Note: it is not used to re-encode the input, rather enables handling of encoded strings in their native encoding.</p></dd>
<dt>...</dt>
<dd><p>Other arguments used by individual methods.</p></dd>
<dt>drop_table</dt>
<dd><p>logical, whether to drop the table before creating it</p></dd>
<dt>cascade</dt>
<dd><p>logical, whether to add CASCADE to the DROP statement</p></dd>
<dt>if_not_exists</dt>
<dd><p>logical, to add IF NOT EXISTS to the query</p></dd>
<dt>create_foreign_server</dt>
<dd><p>logical, to create the extension and server
for the foreign data wrapper (<a href="https://www.postgresql.org/docs/10/file-fdw.html" class="external-link">https://www.postgresql.org/docs/10/file-fdw.html</a>)</p></dd>
<dt>execute</dt>
<dd><p>logical, whether to execute the query using <code>con</code></p></dd>
<dt>quote</dt>
<dd><p>By default (<code>"\""</code>), if a field starts with a double quote, <code>fread</code> handles embedded quotes robustly as explained under <code>Details</code>. If it fails, then another attempt is made to read the field <em>as is</em>, i.e., as if quotes are disabled. By setting <code>quote=""</code>, the field is always read as if quotes are disabled. It is not expected to ever need to pass anything other than \"\" to quote; i.e., to turn it off.</p></dd>
<dt>escape</dt>
<dd><p>"character that should appear before a data character that
matches the QUOTE value"</p></dd>
<dt>null</dt>
<dd><p>"Specifies the string that represents a null value."</p></dd>
</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>invisibly returns a character vector (length 1) with the sql
statement</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>Some notes:</p><ul><li><p>The file must be accesible to the postgres server. This function tries to
edit file's privileges to make sure is readable from the server.
However, if the file is in a network share, that may not be enough because
the server should be able to access the network resource. It is likely
the default user running the server cannot access network shared resources,
so the workaround is to change the user running the server</p></li>
</ul><p>See Postgres documentation:</p><ul><li><p><a href="https://www.postgresql.org/docs/10/sql-createforeigntable.html" class="external-link">Foreign table https://www.postgresql.org/docs/10/sql-createforeigntable .html</a></p></li>
<li><p><a href="https://www.postgresql.org/docs/10/file-fdw.html" class="external-link">Foreign-data wrapper for files https://www.postgresql.org/docs/10/file- fdw.html</a></p></li>
<li><p><a href="https://www.postgresql.org/docs/10/sql-copy.html" class="external-link">Options documented in COPY https://www.postgresql.org/docs/10/sql-copy .html</a></p></li>
</ul></div>

  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Eduardo Alfonso-Sierra.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.1.</p>
</div>

      </footer></div>

  


  

  </body></html>

